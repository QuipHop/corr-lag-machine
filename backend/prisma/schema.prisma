// prisma/schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Experiment {
  id         String    @id @default(uuid())
  name       String
  context    String? // наприклад "UA wage", "PL wage"
  frequency  String // "M" / "Q" / "Y"
  horizon    Int
  createdAt  DateTime  @default(now())
  finishedAt DateTime?

  // Повні JSON з ml-svc, щоб фронт міг показати пояснення
  diagnostics  Json
  correlations Json
  factors      Json

  // Зв'язки
  models    Model[]
  forecasts Forecast[]
  metrics   ExperimentMetric[]
}

model Model {
  id           String     @id @default(uuid())
  experimentId String
  experiment   Experiment @relation(fields: [experimentId], references: [id])

  seriesName String
  modelType  String
  paramsJson Json
  mase       Float?
  smape      Float?
  rmse       Float?
  isSelected Boolean @default(false)
}

model Forecast {
  id           String     @id @default(uuid())
  experimentId String
  experiment   Experiment @relation(fields: [experimentId], references: [id])

  seriesName  String
  date        DateTime
  valueActual Float?
  valuePred   Float?
  lowerPi     Float?
  upperPi     Float?
  setType     String // "train" / "test" / "future"
}

model ExperimentMetric {
  id           String     @id @default(uuid())
  experimentId String
  experiment   Experiment @relation(fields: [experimentId], references: [id])

  seriesName String
  modelType  String
  horizon    Int
  mase       Float
  smape      Float
  rmse       Float
}
